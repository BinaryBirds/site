<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>How to write OpenAPI specs using Swift and OpenAPIKit? - Binary Birds</title>
    
    <meta name="description" content="In this tutorial I'll show you how to build OpenAPI 3.0+ specifications efficiently using Swift & OpenAPIKit.">
    
    <meta property="og:title" content="How to write OpenAPI specs using Swift and OpenAPIKit? - Binary Birds">
    <meta property="og:description" content="In this tutorial I'll show you how to build OpenAPI 3.0+ specifications efficiently using Swift & OpenAPIKit.">
    <meta property="og:url" content="https://binarybirds.com/how-to-write-openapi-specs-using-swift-and-openapi-kit/">
    <meta property="og:image" content="https://binarybirds.com/images/assets/how-to-write-openapi-specs-using-swift-and-openapi-kit/cover.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@tiborbodecs">
    <meta name="twitter:creator" content="@tiborbodecs">
    <meta name="twitter:title" content="How to write OpenAPI specs using Swift and OpenAPIKit? - Binary Birds">
    <meta name="twitter:description" content="In this tutorial I'll show you how to build OpenAPI 3.0+ specifications efficiently using Swift & OpenAPIKit.">
    <meta name="twitter:image" content="https://binarybirds.com/images/assets/how-to-write-openapi-specs-using-swift-and-openapi-kit/cover.jpg">
    
    <link rel="stylesheet" href="https://binarybirds.com/css/style.css">
    <link rel="stylesheet" href="https://binarybirds.com/css/syntax.css">

    <link rel="shortcut icon" href="https://binarybirds.com/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://binarybirds.com/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://binarybirds.com/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://binarybirds.com/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://binarybirds.com/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://binarybirds.com/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://binarybirds.com/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://binarybirds.com/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://binarybirds.com/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://binarybirds.com/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://binarybirds.com/images/icons/apple-touch-icon-180x180.png">
    
</head>

<body>
    <header id="page-header">
        <a href="https://binarybirds.com/">
            <figure>
                <picture>
                    <source 
                        srcset="https://binarybirds.com/images/logos/logo~dark.png" 
                        media="(prefers-color-scheme: dark)"
                    >
                    <img 
                        id="logo-image"
                        src="https://binarybirds.com/images/logos/logo.png"
                        alt="Logo of Binary Birds"
                        title="Binary Birds"
                    >
                </picture>
            </figure>
        </a>
    </header>
    
    <main>

        <article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2023/07/06">2023/07/06</time>
            <h1 class="title">How to write OpenAPI specs using Swift and OpenAPIKit?</h1>
            <p class="excerpt">In this tutorial I'll show you how to build OpenAPI 3.0+ specifications efficiently using Swift & OpenAPIKit.</p>
            <div class="meta">
                <span class="tag">Swift</span>
<span class="tag">OpenAPI</span>
            </div>
        </section>
        <section class="wrapper">
            <img id="post-image" src="https://binarybirds.com/images/assets/how-to-write-openapi-specs-using-swift-and-openapi-kit/cover.jpg">
        </section>
    </header>

    <section id="contents" class="content-wrapper">
    
    <h2>Getting started</h2><p>Have you ever written an OpenAPI spec using YAML / JSON files? Well, I have created several documents and I had some problems with those formats. My main issue is that I constantly want to separate components, and I always end up using standalone files for those. This sounds fine, but if you decompose everything, including parameters, responses and other stuff it can cause some issues when you host your documentation online. The <a href="https://github.com/swagger-api/swagger-ui" target="_blank">SwaggerUI</a> library renders the documentation extremely slow when it has to pull the specification from multiple source files. One possible solution is to combine your spec into a large <code>swagger.json</code> file, there are some tools for this purpose, but lately I've discovered an alternative... using Swift &amp; the <a href="https://github.com/mattpolzin/OpenAPIKit" target="_blank">OpenAPIKit</a> library. ðŸ“¦</p><hr><p>This tutorial is a practical walkthrough, but you can also download the <a href="https://github.com/binarybirds/swagger-petstore" target="_blank">sample repository from GitHub</a> right away.</p><hr><p>Let's get started with a new Swift package, you can setup the project using the following <code>Package.swift</code> file:</p><pre><code class="language-swift"><span class="comment">// swift-tools-version: 5.8</span>
<span class="keyword">import</span> PackageDescription

<span class="keyword">let</span> package = <span class="type">Package</span>(
    name: <span class="string">"swagger-petstore"</span>,
    platforms: [
        .<span class="call">macOS</span>(.<span class="dotAccess">v10_15</span>),
    ],
    dependencies: [
        .<span class="call">package</span>(
            url: <span class="string">"https://github.com/mattpolzin/OpenAPIKit"</span>,
            from: <span class="string">"3.0.0-alpha.8"</span>
        ),
        .<span class="call">package</span>(
            url: <span class="string">"https://github.com/jpsim/Yams"</span>,
            from: <span class="string">"5.0.6"</span>
        ),
    ],
    targets: [
        .<span class="call">executableTarget</span>(
            name: <span class="string">"SwaggerPetstore"</span>,
            dependencies: [
                .<span class="call">product</span>(name: <span class="string">"OpenAPIKit30"</span>, package: <span class="string">"OpenAPIKit"</span>),
                .<span class="call">product</span>(name: <span class="string">"Yams"</span>, package: <span class="string">"Yams"</span>),
            ]
        )
    ]
)</code></pre><p>We just need a simple executable target that will serve as a generator, to build our swagger files. Anyway, working with OpenAPIKit is not that hard, but for me it's a bit more easy to reference components by using the following extensions. Feel free to place them inside a <code>OpenAPI+Extensions.swift</code> file somewhere inside your project.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30
<span class="keyword">import</span> OpenAPIKitCore

<span class="keyword">extension</span> <span class="type">OpenAPI</span>.<span class="type">Content</span> {

    <span class="keyword">static func</span> ref(<span class="keyword">_</span> name: <span class="type">String</span>) -&gt; <span class="type">Self</span> {
        .<span class="keyword">init</span>(schemaReference: .<span class="dotAccess">internal</span>(.<span class="call">component</span>(name: name)))
    }
}

<span class="keyword">extension</span> <span class="type">JSONSchema</span> {

    <span class="keyword">static func</span> ref(<span class="keyword">_</span> name: <span class="type">String</span>) -&gt; <span class="type">JSONSchema</span> {
        .<span class="call">reference</span>(.<span class="call">component</span>(named: name))
    }
}

<span class="keyword">extension</span> <span class="type">Either</span>&lt;<span class="type">JSONReference</span>&lt;<span class="type">OpenAPI</span>.<span class="type">Parameter</span>&gt;, <span class="type">OpenAPI</span>.<span class="type">Parameter</span>&gt; {

    <span class="keyword">static func</span> ref(<span class="keyword">_</span> name: <span class="type">String</span>) -&gt; <span class="type">Self</span> {
        <span class="type">Self</span>.<span class="call">reference</span>(.<span class="call">component</span>(named: name))
    }
}

<span class="keyword">extension</span> <span class="type">Either</span>&lt;<span class="type">JSONReference</span>&lt;<span class="type">OpenAPI</span>.<span class="type">Response</span>&gt;, <span class="type">OpenAPI</span>.<span class="type">Response</span>&gt; {

    <span class="keyword">static func</span> ref(<span class="keyword">_</span> name: <span class="type">String</span>) -&gt; <span class="type">Self</span> {
        <span class="type">Self</span>.<span class="call">reference</span>(.<span class="call">component</span>(named: name))
    }
}</code></pre><p>The next thing that we're going to create is the <code>Server</code> namespace, this will contain some generic stuff that can be applied to the entire API.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation

<span class="keyword">enum</span> Server {}</code></pre><p>We're going to use UUID values as primary identifiers, so it seems like a good idea to add a <code>Field</code> extension with a static <code>uuid</code> function for this purpose. We're also going to use image URLs so, let's define one more field inside the <code>Server+Fields.swift</code> extension. ðŸ¤”</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Server</span> {

    <span class="keyword">enum</span> Fields {
        
        <span class="keyword">static func</span> uuid(
            required: <span class="type">Bool</span> = <span class="keyword">true</span>,
            description: <span class="type">String</span> = <span class="string">"Unique identifier"</span>
        ) -&gt; <span class="type">JSONSchema</span> {
            .<span class="call">string</span>(
                format: .<span class="call">extended</span>(.<span class="dotAccess">uuid</span>),
                required: <span class="keyword">required</span>,
                description: description,
                example: <span class="string">"4DB59768-CDFA-4608-BA60-4673A3CB015E"</span>
            )
        }

        <span class="keyword">static func</span> url(
            required: <span class="type">Bool</span> = <span class="keyword">true</span>,
            description: <span class="type">String</span> = <span class="string">"URL"</span>
        ) -&gt; <span class="type">JSONSchema</span> {
            .<span class="call">string</span>(
                format: .<span class="call">extended</span>(.<span class="dotAccess">uri</span>),
                required: <span class="keyword">required</span>,
                description: description,
                example: <span class="string">"https://placekitten.com/512/512"</span>
            )
        }
    }
}</code></pre><p>We're going to use the fields inside the JSON objects, but we can also come up with a <code>Server+Parameters.swift</code> namespace to define generic path and query parameters that we can reuse inside the operations.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Server</span> {

    <span class="keyword">enum</span> Parameters {

        <span class="keyword">static var</span> page: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            <span class="keyword">let</span> name = <span class="string">"page"</span>
            <span class="keyword">return</span> .<span class="keyword">init</span>(
                name: name,
                context: .<span class="dotAccess">query</span>,
                schema: .<span class="call">integer</span>(
                    title: name,
                    minimum: (<span class="number">1</span>, exclusive: <span class="keyword">false</span>),
                    defaultValue: <span class="number">1</span>,
                    example: <span class="number">1</span>
                ),
                description: <span class="string">"Page offset of the list"</span>
            )
        }
        
        <span class="keyword">static var</span> size: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            <span class="keyword">let</span> name = <span class="string">"size"</span>
            <span class="keyword">return</span> .<span class="keyword">init</span>(
                name: name,
                context: .<span class="dotAccess">query</span>,
                schema: .<span class="call">integer</span>(
                    title: name,
                    minimum: (<span class="number">1</span>, exclusive: <span class="keyword">false</span>),
                    defaultValue: <span class="number">50</span>,
                    example: <span class="number">50</span>
                ),
                description: <span class="string">"Number of items per page"</span>
            )
        }
        
        <span class="keyword">static var</span> search: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            <span class="keyword">let</span> name = <span class="string">"search"</span>
            <span class="keyword">return</span> .<span class="keyword">init</span>(
                name: name,
                context: .<span class="dotAccess">query</span>,
                schema: .<span class="call">string</span>(
                    example: <span class="string">""</span>
                ),
                description: <span class="string">"Search with some value"</span>
            )
        }
        
        <span class="keyword">static var</span> order: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            .<span class="keyword">init</span>(
                name: <span class="string">"order"</span>,
                context: .<span class="dotAccess">query</span>,
                schema: .<span class="call">string</span>(
                    allowedValues: <span class="string">"asc"</span>, <span class="string">"desc"</span>,
                    defaultValue: <span class="string">"asc"</span>,
                    example: <span class="string">"asc"</span>
                ),
                description: <span class="string">"Order the results ascending or descending (asc, desc)"</span>
            )
        }
    }
}</code></pre><p>Same thing goes for the security schemes, in this case we just simply define a <code>bearerAuth</code> reference to a component, which we're going to implement inside the OpenAPI doc. ðŸ“„</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Server</span> {
    
    <span class="keyword">enum</span> Security {
        
        <span class="keyword">static let</span> bearerAuth: [<span class="type">OpenAPI</span>.<span class="type">SecurityRequirement</span>] = [
            [
                .<span class="call">component</span>(named: <span class="string">"bearerAuth"</span>): []
            ]
        ]
    }
}</code></pre><p>The very last thing seems like a bit complex, but it's just a generic error message and a list object that can contain other JSON elements. This is how you can generate the OpenAPI definition for that using static Swift helper functions:</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Server</span> {

    <span class="keyword">enum</span> Components {

        <span class="keyword">static var</span> error: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"message"</span>: .<span class="call">string</span>(
                        required: <span class="keyword">true</span>,
                        description: <span class="string">"The user facing error message."</span>,
                        example: <span class="string">"Something went wrong with the request."</span>
                    ),
                    <span class="string">"details"</span>: .<span class="call">array</span>(
                        items: .<span class="call">object</span>(
                            properties: [
                                <span class="string">"key"</span>: .<span class="call">string</span>(
                                    required: <span class="keyword">true</span>,
                                    description: <span class="string">"The error key"</span>,
                                    example: <span class="string">"field"</span>
                                ),
                                <span class="string">"message"</span>: .<span class="call">string</span>(
                                    required: <span class="keyword">true</span>,
                                    description: <span class="string">"The user facing error message"</span>,
                                    example: <span class="string">"Something is wrong with the field."</span>
                                ),
                            ]
                        )
                    ),
                ]
            )
        }

        <span class="keyword">static func</span> page() -&gt; <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"size"</span>: .<span class="call">integer</span>(
                        required: <span class="keyword">true</span>,
                        maximum: (<span class="number">1000</span>, exclusive: <span class="keyword">false</span>),
                        minimum: (<span class="number">10</span>, exclusive: <span class="keyword">false</span>),
                        defaultValue: <span class="number">50</span>,
                        example: <span class="number">25</span>
                    ),
                    <span class="string">"current"</span>: .<span class="call">integer</span>(
                        required: <span class="keyword">true</span>,
                        minimum: (<span class="number">0</span>, exclusive: <span class="keyword">false</span>),
                        defaultValue: <span class="number">0</span>,
                        example: <span class="number">12</span>
                    ),
                    <span class="string">"total"</span>: .<span class="call">integer</span>(
                        required: <span class="keyword">true</span>,
                        minimum: (<span class="number">0</span>, exclusive: <span class="keyword">false</span>),
                        defaultValue: <span class="number">0</span>,
                        example: <span class="number">42</span>
                    ),
                ]
            )
        }

        <span class="keyword">static func</span> list(
            reference: <span class="type">String</span>,
            orderKeys: [<span class="type">String</span>]? = <span class="keyword">nil</span>
        ) -&gt; <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"items"</span>: .<span class="call">array</span>(
                        items: .<span class="call">reference</span>(.<span class="call">component</span>(named: reference))
                    ),
                    <span class="string">"metadata"</span>: .<span class="call">object</span>(
                        properties: [
                            <span class="string">"page"</span>: <span class="type">Self</span>.<span class="call">page</span>(),
                            <span class="string">"items"</span>: .<span class="call">object</span>(
                                properties: [
                                    <span class="string">"total"</span>: .<span class="call">integer</span>(
                                        required: <span class="keyword">true</span>,
                                        minimum: (<span class="number">0</span>, exclusive: <span class="keyword">false</span>),
                                        defaultValue: <span class="number">0</span>,
                                        example: <span class="number">69</span>
                                    )
                                ]
                            ),
                            <span class="string">"sort"</span>: .<span class="call">object</span>(
                                properties: [
                                    <span class="string">"by"</span>: .<span class="call">string</span>(
                                        required: <span class="keyword">false</span>,
                                        description: <span class="string">"Sort the list by ascending or descending order"</span>,
                                        allowedValues: <span class="string">"asc"</span>, <span class="string">"desc"</span>,
                                        defaultValue: <span class="string">"asc"</span>
                                    ),
                                    <span class="string">"order"</span>: .<span class="call">string</span>(
                                        required: <span class="keyword">false</span>,
                                        description: <span class="string">"Field key to order the list"</span>,
                                        allowedValues: orderKeys <span class="keyword">as</span>? [<span class="type">AnyCodable</span>]
                                    ),
                                ]
                            ),
                            <span class="string">"search"</span>: .<span class="call">string</span>(
                                required: <span class="keyword">false</span>,
                                description: <span class="string">"Search term"</span>
                            ),
                        ]
                    ),
                ]
            )
        }
    }
}</code></pre><p>Now that we're ready with the basic building blocks, let's start creating some actual endpoints. I'm going to show you how to create a complete REST API for a category object type and based on this you should be able to apply the very same pattern to other REST objects. ðŸ”„</p><p>Again, we start with a namespace, by using a Swift enum:</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation

<span class="keyword">enum</span> Category {}</code></pre><p>Next, we define some helpers for the fields of the category object. Note that we don't have to create a helper for the <code>id</code> field, because we already have that one in the <code>Server.Fields</code> namespace. Apart from the unique identifier, a category will only have a <code>name</code> field.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Category</span> {

    <span class="keyword">enum</span> Fields {

        <span class="keyword">static func</span> name(required: <span class="type">Bool</span> = <span class="keyword">true</span>) -&gt; <span class="type">JSONSchema</span> {
            .<span class="call">string</span>(
                required: <span class="keyword">required</span>,
                description: <span class="string">"Name of the category"</span>,
                example: <span class="string">"Cat"</span>
            )
        }
    }
}</code></pre><p>By using the previously defined helpers, we can simply come up with the component structure for the Category model. I always like to separate the DTOs (Date Transfer Object) for every REST call, so in our case:</p><ul><li>reference - for references in other objects</li><li>list - <code>GET /models/</code></li><li>detail - <code>GET /models/{id}</code></li><li>create - <code>POST /models/</code></li><li>update - <code>PUT /models/{id}</code></li><li>patch - <code>PATCH /models/{id}</code></li></ul><p>This might looks like an overkill, but on the long term it's worth to separate these contexts (or maybe not, who knows... ðŸ˜…).</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Category</span> {

    <span class="keyword">enum</span> Components {

        <span class="keyword">static var</span> reference: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"id"</span>: <span class="type">Server</span>.<span class="type">Fields</span>.<span class="call">uuid</span>(),
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>(),
                ]
            )
        }

        <span class="keyword">static var</span> list: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"id"</span>: <span class="type">Server</span>.<span class="type">Fields</span>.<span class="call">uuid</span>(),
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>(),
                ]
            )
        }

        <span class="keyword">static var</span> detail: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"id"</span>: <span class="type">Server</span>.<span class="type">Fields</span>.<span class="call">uuid</span>(),
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>(),
                ]
            )
        }

        <span class="keyword">static var</span> create: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>()
                ]
            )
        }

        <span class="keyword">static var</span> update: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>()
                ]
            )
        }

        <span class="keyword">static var</span> patch: <span class="type">JSONSchema</span> {
            .<span class="call">object</span>(
                properties: [
                    <span class="string">"name"</span>: <span class="type">Fields</span>.<span class="call">name</span>(required: <span class="keyword">false</span>)
                ]
            )
        }
    }

}</code></pre><p>Before we deal with the REST operations, we still have to define some parameters. We're going to create a <code>categoryId</code> path parameter for category id references, and a sort parameter for the list operation, this way we can specify the allowed sort keys (<code>name</code> only in this case).</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Category</span> {

    <span class="keyword">enum</span> Parameters {

        <span class="keyword">static var</span> id: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            .<span class="keyword">init</span>(
                name: <span class="string">"categoryId"</span>,
                context: .<span class="dotAccess">path</span>,
                schema: <span class="type">Server</span>.<span class="type">Fields</span>.<span class="call">uuid</span>()
            )
        }

        <span class="keyword">static var</span> sort: <span class="type">OpenAPI</span>.<span class="type">Parameter</span> {
            <span class="keyword">return</span> .<span class="keyword">init</span>(
                name: <span class="string">"sort"</span>,
                context: .<span class="dotAccess">query</span>,
                schema: .<span class="call">string</span>(
                    allowedValues: <span class="string">"name"</span>,
                    defaultValue: <span class="string">"name"</span>,
                    example: <span class="string">"name"</span>
                ),
                description: <span class="string">"Sort with the given value"</span>
            )
        }
    }
}</code></pre><p>Building the operations for the REST endpoints is pretty straightforward if you are already familiar with the <a href="https://swagger.io/specification/" target="_blank">OpenAPI specification</a>. We're not going to explain that in this tutorial, but here's the complete example, to serve as a pattern for you.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">Category</span> {

    <span class="keyword">enum</span> Operations {

        <span class="keyword">static var</span> list: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Find categories"</span>,
                description: <span class="string">"List categories"</span>,
                operationId: <span class="string">"listCategories"</span>,
                parameters: [
                    .<span class="call">ref</span>(<span class="string">"page"</span>),
                    .<span class="call">ref</span>(<span class="string">"size"</span>),
                    .<span class="call">ref</span>(<span class="string">"search"</span>),
                    .<span class="call">ref</span>(<span class="string">"categorySort"</span>),
                    .<span class="call">ref</span>(<span class="string">"order"</span>),
                ],
                responses: [
                    <span class="number">200</span>: .<span class="call">response</span>(
                        description: <span class="string">"List of categories"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                                schema: <span class="type">Server</span>.<span class="type">Components</span>.<span class="call">list</span>(
                                    reference: <span class="string">"CategoryList"</span>
                                )
                            )
                        ]
                    ),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="keyword">static var</span> create: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Create a category"</span>,
                description: <span class="string">"Creates a new category object"</span>,
                operationId: <span class="string">"createCategory"</span>,
                requestBody: .<span class="keyword">init</span>(content: [
                    .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryCreate"</span>)
                ]),
                responses: [
                    <span class="number">200</span>: .<span class="call">response</span>(
                        description: <span class="string">"The details of a category object"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryDetail"</span>)
                        ]
                    ),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="keyword">static var</span> bulkDelete: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Bulk delete categories"</span>,
                description: <span class="string">"Removes multiple categories objects at once"</span>,
                operationId: <span class="string">"deleteCategories"</span>,
                requestBody: .<span class="keyword">init</span>(content: [
                    .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                        schema: .<span class="call">array</span>(
                            items: <span class="type">Server</span>.<span class="type">Fields</span>.<span class="call">uuid</span>()
                        )
                    )
                ]),
                responses: [
                    <span class="number">204</span>: .<span class="call">ref</span>(<span class="string">"204"</span>),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="comment">// MARK: - currency id</span>

        <span class="keyword">static var</span> detail: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Category details"</span>,
                description: <span class="string">"Get the details of a category object"</span>,
                operationId: <span class="string">"getCategory"</span>,
                parameters: [
                    .<span class="call">ref</span>(<span class="string">"categoryId"</span>)
                ],
                responses: [
                    <span class="number">200</span>: .<span class="call">response</span>(
                        description: <span class="string">"The details of a category object"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryDetail"</span>)
                        ]
                    ),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                    <span class="number">404</span>: .<span class="call">ref</span>(<span class="string">"404"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="keyword">static var</span> update: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Update a category object"</span>,
                description: <span class="string">"Updates an entire category object"</span>,
                operationId: <span class="string">"updateCategory"</span>,
                parameters: [
                    .<span class="call">ref</span>(<span class="string">"categoryId"</span>)
                ],
                requestBody: .<span class="keyword">init</span>(content: [
                    .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryUpdate"</span>)
                ]),
                responses: [
                    <span class="number">200</span>: .<span class="call">response</span>(
                        description:
                            <span class="string">"The details of the patched category object"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryDetail"</span>)
                        ]
                    ),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="keyword">static var</span> patch: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Patch a category object"</span>,
                description: <span class="string">"Patch the properties of a given category object"</span>,
                operationId: <span class="string">"patchCategory"</span>,
                parameters: [
                    .<span class="call">ref</span>(<span class="string">"categoryId"</span>)
                ],
                requestBody: .<span class="keyword">init</span>(content: [
                    .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryPatch"</span>)
                ]),
                responses: [
                    <span class="number">200</span>: .<span class="call">response</span>(
                        description:
                            <span class="string">"The details of the patched category object"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="call">ref</span>(<span class="string">"CategoryDetail"</span>)
                        ]
                    ),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                    <span class="number">404</span>: .<span class="call">ref</span>(<span class="string">"404"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }

        <span class="keyword">static var</span> delete: <span class="type">OpenAPI</span>.<span class="type">Operation</span> {
            .<span class="keyword">init</span>(
                tags: [<span class="string">"Categories"</span>],
                summary: <span class="string">"Delete a category object"</span>,
                description:
                    <span class="string">"Removes a category object using the unique identifier"</span>,
                operationId: <span class="string">"deleteCategory"</span>,
                parameters: [
                    .<span class="call">ref</span>(<span class="string">"categoryId"</span>)
                ],
                responses: [
                    <span class="number">204</span>: .<span class="call">ref</span>(<span class="string">"204"</span>),
                    <span class="number">400</span>: .<span class="call">ref</span>(<span class="string">"400"</span>),
                    <span class="number">401</span>: .<span class="call">ref</span>(<span class="string">"401"</span>),
                    <span class="number">403</span>: .<span class="call">ref</span>(<span class="string">"403"</span>),
                    <span class="number">404</span>: .<span class="call">ref</span>(<span class="string">"404"</span>),
                ],
                security: <span class="type">Server</span>.<span class="type">Security</span>.<span class="property">bearerAuth</span>
            )
        }
    }
}</code></pre><p>As you can see there are some <code>.ref()</code> calls inside the code and we still have to create the entire document specification including the reference points defined as components. We're going to do this now by creating an extension over the <code>OpenAPI.Document</code> type. ðŸ¥³</p><pre><code class="language-swift"><span class="keyword">import</span> OpenAPIKit30

<span class="keyword">extension</span> <span class="type">OpenAPI</span>.<span class="type">Document</span> {

    <span class="keyword">static var</span> definition: <span class="type">OpenAPI</span>.<span class="type">Document</span> {
        .<span class="keyword">init</span>(
            info: .<span class="keyword">init</span>(
                title: <span class="string">"Swagger Petstore - written in Swift"</span>,
                description:
                    <span class="string">"This is a sample Pet Store Server based on the OpenAPI 3.0 specification generated using Swift &amp; OpenAPIKit."</span>,
                contact: .<span class="keyword">init</span>(
                    name: <span class="string">"Binary Birds"</span>,
                    url: .<span class="keyword">init</span>(string: <span class="string">"https://binarybirds.com"</span>)!,
                    email: <span class="string">"info@binarybirds.com"</span>
                ),
                version: <span class="string">"1.0.0"</span>
            ),
            servers: [
                .<span class="keyword">init</span>(
                    url: .<span class="keyword">init</span>(string: <span class="string">"http://127.0.0.1:8080"</span>)!,
                    description: <span class="string">"dev"</span>
                ),
                .<span class="keyword">init</span>(
                    url: .<span class="keyword">init</span>(string: <span class="string">"http://127.0.0.1:8081"</span>)!,
                    description: <span class="string">"live"</span>
                ),
            ],
            paths: [
                <span class="string">"/categories"</span>: .<span class="keyword">init</span>(
                    get: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">list</span>,
                    post: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">create</span>,
                    delete: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">bulkDelete</span>
                ),
                <span class="string">"/categories/{categoryId}"</span>: .<span class="keyword">init</span>(
                    get: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">detail</span>,
                    put: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">update</span>,
                    delete: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">delete</span>,
                    patch: <span class="type">Category</span>.<span class="type">Operations</span>.<span class="property">patch</span>
                ),
            ],
            components: .<span class="keyword">init</span>(
                schemas: [
                    <span class="string">"ErrorResponse"</span>: <span class="type">Server</span>.<span class="type">Components</span>.<span class="property">error</span>,

                    <span class="string">"CategoryReference"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">reference</span>,
                    <span class="string">"CategoryList"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">list</span>,
                    <span class="string">"CategoryDetail"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">detail</span>,
                    <span class="string">"CategoryCreate"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">create</span>,
                    <span class="string">"CategoryUpdate"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">update</span>,
                    <span class="string">"CategoryPatch"</span>: <span class="type">Category</span>.<span class="type">Components</span>.<span class="property">patch</span>,

                ],
                responses: [
                    <span class="string">"204"</span>: .<span class="keyword">init</span>(description: <span class="string">"No content"</span>),
                    <span class="string">"400"</span>: .<span class="keyword">init</span>(
                        description: <span class="string">"Bad request"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                                schema: .<span class="call">reference</span>(
                                    .<span class="call">component</span>(named: <span class="string">"ErrorResponse"</span>)
                                )
                            )
                        ]
                    ),
                    <span class="string">"401"</span>: .<span class="keyword">init</span>(
                        description: <span class="string">"Unauthorized"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                                schema: .<span class="call">reference</span>(
                                    .<span class="call">component</span>(named: <span class="string">"ErrorResponse"</span>)
                                )
                            )
                        ]
                    ),
                    <span class="string">"403"</span>: .<span class="keyword">init</span>(
                        description: <span class="string">"Forbidden"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                                schema: .<span class="call">reference</span>(
                                    .<span class="call">component</span>(named: <span class="string">"ErrorResponse"</span>)
                                )
                            )
                        ]
                    ),
                    <span class="string">"404"</span>: .<span class="keyword">init</span>(
                        description: <span class="string">"Not found"</span>,
                        content: [
                            .<span class="dotAccess">json</span>: .<span class="keyword">init</span>(
                                schema: .<span class="call">reference</span>(
                                    .<span class="call">component</span>(named: <span class="string">"ErrorResponse"</span>)
                                )
                            )
                        ]
                    ),
                ],
                parameters: [
                    <span class="string">"categoryId"</span>: <span class="type">Category</span>.<span class="type">Parameters</span>.<span class="property">id</span>,
                    <span class="string">"categorySort"</span>: <span class="type">Category</span>.<span class="type">Parameters</span>.<span class="property">sort</span>,

                    <span class="string">"page"</span>: <span class="type">Server</span>.<span class="type">Parameters</span>.<span class="property">page</span>,
                    <span class="string">"size"</span>: <span class="type">Server</span>.<span class="type">Parameters</span>.<span class="property">size</span>,
                    <span class="string">"search"</span>: <span class="type">Server</span>.<span class="type">Parameters</span>.<span class="property">search</span>,
                    <span class="string">"order"</span>: <span class="type">Server</span>.<span class="type">Parameters</span>.<span class="property">order</span>,
                ],
                examples: [:],
                requestBodies: [:],
                headers: [:],
                securitySchemes: [
                    <span class="string">"bearerAuth"</span>: .<span class="keyword">init</span>(
                        type: .<span class="call">http</span>(
                            scheme: <span class="string">"bearer"</span>,
                            bearerFormat: <span class="string">"token"</span>
                        ),
                        description: <span class="string">"Authorization header using a Bearer token"</span>
                    )
                ]
            ),
            tags: [
                .<span class="keyword">init</span>(
                    name: <span class="string">"Categories"</span>,
                    description: <span class="string">"Pet categories, such as cat, dog, etc."</span>
                ),
            ]
        )
    }
}</code></pre><p>Finally in the <code>main.swift</code> file we're going to generate both the YAML and the JSON output.</p><pre><code class="language-swift"><span class="keyword">import</span> Foundation
<span class="keyword">import</span> OpenAPIKit30
<span class="keyword">import</span> Yams

<span class="keyword">let</span> basePath =
    <span class="string">"/"</span>
    + <span class="keyword">#file</span>
    .<span class="call">split</span>(separator: <span class="string">"/"</span>)
    .<span class="call">dropLast</span>(<span class="number">3</span>)
    .<span class="call">joined</span>(separator: <span class="string">"/"</span>)
    .<span class="call">appending</span>(<span class="string">"/dist"</span>)

<span class="keyword">if</span> !<span class="type">FileManager</span>.<span class="property">default</span>.<span class="call">fileExists</span>(atPath: basePath) {
    <span class="keyword">try</span> <span class="type">FileManager</span>.<span class="property">default</span>.<span class="call">createDirectory</span>(
        atPath: basePath,
        withIntermediateDirectories: <span class="keyword">true</span>
    )
}

<span class="keyword">let</span> doc = <span class="type">OpenAPI</span>.<span class="type">Document</span>.<span class="property">definition</span>
<span class="keyword">let</span> yamlEncoder = <span class="type">YAMLEncoder</span>()
<span class="keyword">let</span> yamlData = <span class="keyword">try</span> yamlEncoder.<span class="call">encode</span>(doc)
<span class="keyword">let</span> yamlPath = <span class="string">"</span>\(basePath)<span class="string">/swagger.yaml"</span>
<span class="keyword">try</span> yamlData.<span class="call">write</span>(
    to: <span class="type">URL</span>(fileURLWithPath: yamlPath),
    atomically: <span class="keyword">true</span>,
    encoding: .<span class="dotAccess">utf8</span>
)

<span class="keyword">let</span> jsonEncoder = <span class="type">JSONEncoder</span>()
jsonEncoder.<span class="property">outputFormatting</span> = [
    .<span class="dotAccess">prettyPrinted</span>,
    .<span class="dotAccess">withoutEscapingSlashes</span>,
]
<span class="keyword">let</span> jsonData = <span class="keyword">try</span> jsonEncoder.<span class="call">encode</span>(doc)
<span class="keyword">let</span> jsonPath = <span class="string">"</span>\(basePath)<span class="string">/swagger.json"</span>
<span class="keyword">try</span> jsonData.<span class="call">write</span>(
    to: <span class="type">URL</span>(fileURLWithPath: jsonPath),
    options: .<span class="dotAccess">atomic</span>
)</code></pre><p>Of course we have a working template repository that you can <a href="https://github.com/binarybirds/swagger-petstore" target="_blank">download for free</a>. This repository contains some more common patterns, including N to many relations and some other useful stuff, that you might encounter when you try to build an API specification for your backend service. ðŸ˜Š</p>
        
    </section>

</article>
        
    </main>

    <footer>
        <section class="content-wrapper">
            <figure>
                <picture>
                    <source 
                        srcset="https://binarybirds.com/images/logos/logo~dark.png" 
                        media="(prefers-color-scheme: dark)"
                    >
                    <img 
                        id="logo-image"
                        src="https://binarybirds.com/images/logos/logo.png"
                        alt="Logo of Binary Birds"
                        title="Binary Birds"
                    >
                </picture>
            </figure>

            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p> 
                <a href="https://binarybirds.com/">Home</a> Â·
                <a href="mailto:binarybirdsofficial@gmail.com">Email</a> Â·
                <a href="https://github.com/binarybirds/">GitHub</a> Â·
                <a href="https://twitter.com/tiborbodecs">Twitter</a> Â·
                <a href="https://binarybirds.com/rss.xml" target="_blank">RSS</a> Â·
                <a href="https://binarybirds.com/sitemap.xml" target="_blank">Sitemap</a>
            </p>
            
            <p class="small">Binary Birds &copy; 2022 - 2023.</p>
        </section>
    </footer>
</body>
</html>
